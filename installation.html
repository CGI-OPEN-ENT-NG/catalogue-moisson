<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Installation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Installation</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Avant de déployer il faut impérativement configurer l&#8217;application et créer la base de données et les rôles
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>1 - Configuration du fichier de propriétés
2 . Création de la base et des scripts
3 . déploiement de l'application</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_du_fichier_de_propriétés">Configuration du fichier de propriétés.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le fichier de configuration est fourni indépendamment du fichier .war:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Fichier de configuation:
  application-prod.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Une fois les paramètres fixer il faut le déposer dans un répertoire config créé au meme niveau que le répertoire de contexte de l’application:</p>
</div>
<div class="paragraph">
<p>Exemple pour tomcat 9 :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>répertoire de config:
  /tomcat9/webapps/config
répertoire de contexte:
  /tomcat9/webapps/moisooncatalogue</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_paramètres_du_fichier_de_configuration">Paramètres du fichier de configuration :</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_base_de_données">Base de données</h3>
<div class="paragraph">
<p>Il faut modifier le nom d’hôte at éventuellement le port :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>datasource:
  type: com.zaxxer.hikari.HikariDataSource
  # Domaine (nom d'hôte à modifier, par défaut : localhost) et port éventuellement mais généralement c'est le port par défaut.
  # Ne pas modifier le nom de la base  : moissoncatalogue
  url: jdbc:postgresql://localhost:5432/moissoncatalogue
  # Ne pas modifier username: usercatalogue
  username: usercatalogue
  password: catalogue</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Il est possible de changer le mot de passe au sein du fichier.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Si le mot de passe est changé, Il faut, le changer également dans le script d’initialisation de la base avant de le jour (voir explication dans création de la base de données ci-après) :
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>V0__init_user_role_database.sql</pre>
</div>
</div>
<div class="paragraph">
<p>remplacer le mot de passe "catalogue" :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ROLE usercatalogue LOGIN NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION PASSWORD 'catalogue';</pre>
</div>
</div>
<div class="paragraph">
<p>par le NOUVEAU_MOT_DE_PASSE :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ROLE usercatalogue LOGIN NOSUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION PASSWORD 'NOUVEAU_MOT_DE_PASSE';</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_elasticsearch">ElasticSearch</h3>
<div class="paragraph">
<p>Il faut modifier l’hôte le port et définir login et password :</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Hôte et port à modifier sans les scheme (http ou https)
uris: localhost:9200
# A modifier s’il y a une authentification ne pas dé commenter sinon car l’application ne démarre pas.
# username: admin
# password: admin</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_liquibase">Liquibase</h3>
<div class="literalblock">
<div class="content">
<pre>liquibase:
  contexts: prod
  # Domaine (nom d'hôte à modifier par défaut : localhost).
  # Ne pas modifier le nom de la base  : moissoncatalogue
  url: jdbc:postgresql://localhost:5432/moissoncatalogue</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mail">Mail</h3>
<div class="paragraph">
<p>Optionnel car non utilisé pour le moment :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mail:
  host: localhost
  port: 25
  username:
  password:</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_création_de_la_ase_de_données">Création de la ase de données.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_créations_de_la_base_et_des_rôles">Créations de la base et des rôles.</h3>
<div class="paragraph">
<p>Par défaut les tables sont créées avec Liquibase qui est une librairie open-source permettant de tracer et gérer les modifications d&#8217;une base de données.
Liquibase est paramétré pour la mise en place des tables et séquences au premier démarrage de l’application,
cependant avant de lancer l’application il faut créer les roles et la base correspondante.</p>
</div>
<div class="paragraph">
<p>Il faut installer postgres sur le serveur</p>
</div>
<div class="paragraph">
<p>Puis en se connectant en root :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo -u postgres psql</pre>
</div>
</div>
<div class="paragraph">
<p>Il faut jouer les scripts qui sont dans le fichier :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>V0__init_user_role_database.sql est le fichier de création de la base de données</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_création_des_tables">Création des tables</h3>
<div class="paragraph">
<p>L’application utilise Liquibase pour la création des tables.
Ces dernières sont donc créées automatiquement lors du déploiement de l’application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Les scripts SQL sont fournis et situés dans le répertoire db/migration et peuvent être utilisés "As is" ou avec Flyway
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Les noms de fichier de scripts sont au format FlyWay et sont stockés dans le répertoire de recherche par défaut de Flyway bien que celui-ci n&#8217;est pas installé par défaut, main/resources/db/migration.
La procédure d’installation et d’utilisation de Flyway est fournie à la fin du document.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_déploiement_de_lapplication">Déploiement de l’application</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_rest_api">Rest api</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les endpoints des Apis sont fournis dans le contrat d’Api fourni.</p>
</div>
<div class="sect2">
<h3 id="_authentification_préalable">Authentification préalable</h3>
<div class="paragraph">
<p>Les Apis étant sécurisées il faut s&#8217;authentifier pour y accéder.</p>
</div>
<div class="sect3">
<h4 id="_authentification_basique_avec_login_et_mot_de_passe_user_et_password">Authentification basique avec login et mot de passe (user et password)</h4>
<div class="paragraph">
<p>Il existe deux utilisateurs qui permettent de s&#8217;identifier :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>l’utilisateur "admin" avec le password "admin" par défaut qui possède les roles ROLE_USER et ROLE_ADMIN</p>
</li>
<li>
<p>l’utilisateur "user" avec le password "user" par défaut qui possède le role ROLE_USER</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L&#8217;administrateur "admin" peut accéder aux apis en lecture écriture et suppression.</p>
</div>
<div class="paragraph">
<p>L&#8217;utilisateur "user" peut accéder aux apis en lecture seule.</p>
</div>
<div class="paragraph">
<p>Pour accéder aux apis il faut utiliser curl, postman ou insomnia designer</p>
</div>
<div class="paragraph">
<p>1 - Avec curl pour accéder il faut préciser l’"user" et le "password" :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Pour obtenir les informations sur l'utilisateur
curl -v http://admin:admin@localhost:8080/api/account
ou
curl -vu admin:admin http://localhost:8080/api/account</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Pour obtenir la liste des arcticles numériques :
curl -vu admin:admin http://localhost:8080/api/article-numeriques
curl -vu user:user http://localhost:8080/api/article-numeriques</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
-v permet d&#8217;activer le mode verbose -vu étant équivalent à -v -u
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>2 - Avec Postman ou Insomnia il faut saisir les url en prenant soin de bien spécifier le verbe (GET, POST, PUT etc&#8230;&#8203;)</p>
</div>
<div class="paragraph">
<p>Dans l&#8217;onglet authentication ou auth il faut saisir le login et le mot de passe</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Le endpoint suivant retourne le login de l'utilisateur authentifié avec le verbe GET
http://user:user@localhost:8080/api/authenticate</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentification_avec_token_jwt">Authentification avec token JWT</h4>
<div class="paragraph">
<p>L’api est livrée avec une authentification par token JWT.</p>
</div>
<div class="paragraph">
<p>Il faut dan un premier temps générer le token, avec le endpoint <a href="http://user:user@localhost:8080/api/authenticate" class="bare">http://user:user@localhost:8080/api/authenticate</a> et le verbe POST</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl  -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/api/authenticate
le curl génère un token.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>"id_token" : "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1dGgiOiJST0xFX0FETUlOLFJPTEVfVVNFUiIsImV4cCI6MTYwOTAwMzc2M30.bh8fQMGXawP354wGS1qG_KxSCD1_7hmthQej6DZmUWQdlW8J2Lo1j0EH27m9FJiv_o6vS6hu1iUzAi4lt8uegw"</pre>
</div>
</div>
<div class="paragraph">
<p>Il faut ensuite le passer en paramètre dans le header de la requête</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H 'Accept: application/json' -H "Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1dGgiOiJST0xFX0FETUlOLFJPTEVfVVNFUiIsImV4cCI6MTYwOTAwMzc2M30.bh8fQMGXawP354wGS1qG_KxSCD1_7hmthQej6DZmUWQdlW8J2Lo1j0EH27m9FJiv_o6vS6hu1iUzAi4lt8uegw" http://localhost:8080/api/account</pre>
</div>
</div>
<div class="paragraph">
<p>Sous linux il est possible d&#8217;automatiser il faut au préalable installer un parser Json. Par exemple après avoir installé le parser jq il est possible de stocker le token dans une variable d&#8217;environnement</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/api/authenticate | jq -r '.id_token')</pre>
</div>
</div>
<div class="paragraph">
<p>Il suffit en suite de passer le token de la manière suivante :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H 'Accept: application/json' -H "Authorization: Bearer $TOKEN" http://localhost:8080/api/account</pre>
</div>
</div>
<div class="paragraph">
<p>Sous postman ou insomnia il faut faire le POST avec l&#8217;url et ajouter dans le body ce qui correspond au --data du curl (format json):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"username":"admin","password":"admin"}</pre>
</div>
</div>
<div class="paragraph">
<p>Récapitulatif :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl  -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/api/authenticate</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H 'Accept: application/json' -H "Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1dGgiOiJST0xFX0FETUlOLFJPTEVfVVNFUiIsImV4cCI6MTYwNjUwMTMxOH0.5ldyoVOtvIFIt3E4GlmTcfRg82XjodEcObIJ9JRqT3OU4KY_QOYfi7ELqge8xgQsdkene0-0S8F4zamU845Auw" http://localhost:8080/api/account</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/api/authenticate | jq -r '.id_token')</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H 'Accept: application/json' -H "Authorization: Bearer $TOKEN" http://localhost:8080/api/account</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_swagger">Swagger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les composants front-end et back-end étant séparés, l’API expose le composant back-end pour le composant frontal ou des intégrations d’applications tierces.</p>
</div>
<div class="paragraph">
<p>Les spécifications des API back-end sont exposées par l’intermédiaire de Swagger.</p>
</div>
<div class="paragraph">
<p>Pour visualiser les spécifications d’API au format JSON :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/v2/api-docs

dans un navigateur ou

curl -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/v2/api-docs</pre>
</div>
</div>
<div class="paragraph">
<p>Pour visualiser les spécifications d’API avec SwaggerN :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/swagger-ui/index.html

dans un navigateur</pre>
</div>
</div>
<div class="paragraph">
<p>Remplacer <em>localhost:8080</em> par le bon <em>host</em> et le bon <em>port</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_endpoints">Endpoints</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lancer_la_sauvegarde_des_json_en_base_de_donnée">Lancer la sauvegarde des json en base de donnée.</h3>
<div class="paragraph">
<p>Les paramètres de sauvegarde sont num, pap ou all, ils doivent être ajoutés à la find du endpoint :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOKEN=$(curl -X POST -H 'Accept: application/json' -H 'Content-Type: application/json' --data '{"username":"admin","password":"admin"}' http://localhost:8080/api/authenticate | jq -r '.id_token')</pre>
</div>
</div>
<div class="paragraph">
<p>puis pour avoir les articles papiers et numériques (all :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST -H 'Accept: application/json' -H "Authorization: Bearer $TOKEN" http://localhost:8080/api/json/all</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_création_des_tables_du_contexte_test">Création des tables du contexte test</h3>
<div class="paragraph">
<p>Lors de la création des tables avec liquibase, le pom possède un &lt;contexts&gt;!test&lt;/contexts&gt; il faut donc le modifier car la table jhi_date_time_wrapper est absente de la base or elle est nécessaire aux tests &lt;contexts&gt;test&lt;/contexts&gt;.</p>
</div>
<div class="paragraph">
<p>Si le préfixe n’est pas jhi il faut adapter le nom de la table avec le bon préfixe, par ex avec préfixe moisson:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>moisson_date_time_wrapper</pre>
</div>
</div>
<div class="paragraph">
<p>La table correspondante est dans le package :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{basePackage}.repository.timezone:
...
@Entity
@Table(name = "moisson_date_time_wrapper")
public class DateTimeWrapper implements Serializable {...}</pre>
</div>
</div>
<div class="paragraph">
<p>Procédure de rattrapage :</p>
</div>
<div class="paragraph">
<p>créer un fichier yyyyMMddHHmmss_initial_schema_test.xml avec le contenu suivant (les changeset doivent avoir des id différents qui n&#8217;existent pas dans la table databasechangelog)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;databaseChangeLog
xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd
http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd"&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!-- &lt;changeSet author="jhipster" id="yyyyMMddHHmmss" context="test"&gt;
Il faut supprimer context="test" pour la génération
ou bien de modifier le pom en transformant &lt;contexts&gt;!test&lt;/contexts&gt; en &lt;contexts&gt;test&lt;/contexts&gt; dans le pom.xml--&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;changeSet author="jhipster" id="yyyyMMddHHmmss"&gt;
        &lt;createTable tableName="jhi_date_time_wrapper"&gt;
            &lt;column  name="id" type="BIGINT"&gt;
                &lt;constraints primaryKey="true" primaryKeyName="jhi_date_time_wrapperPK"/&gt;
            &lt;/column&gt;
            &lt;column name="instant" type="timestamp"/&gt;
            &lt;column name="local_date_time" type="timestamp"/&gt;
            &lt;column name="offset_date_time" type="timestamp"/&gt;
            &lt;column name="zoned_date_time" type="timestamp"/&gt;
            &lt;column name="local_time" type="time"/&gt;
            &lt;column name="offset_time" type="time"/&gt;
            &lt;column name="local_date" type="date"/&gt;
        &lt;/createTable&gt;
    &lt;/changeSet&gt;
&lt;/databaseChangeLog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Rajouter la ligne dans master.xml :</p>
</div>
<div class="paragraph">
<p>&lt;include file="config/liquibase/changelog/yyyyMMddHHmmss_initial_schema_test.xml" relativeToChangelogFile="false"/&gt;</p>
</div>
<div class="paragraph">
<p>Attention si context="test" est conservé au niveau du pom.xml il faut modifier le pom.xml en conséquense au niveau du plugin liquibase :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;plugin&gt;
&lt;groupId&gt;org.liquibase&lt;/groupId&gt;
&lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;${liquibase.version}&lt;/version&gt;
&lt;configuration&gt;
    &lt;changeLogFile&gt;${project.basedir}/src/main/resources/config/liquibase/master.xml&lt;/changeLogFile&gt;
    &lt;diffChangeLogFile&gt;${project.basedir}/src/main/resources/config/liquibase/changelog/${maven.build.timestamp}_changelog.xml&lt;/diffChangeLogFile&gt;
    &lt;driver&gt;org.postgresql.Driver&lt;/driver&gt;
    &lt;url&gt;jdbc:postgresql://localhost:5432/catalogue-ng-jhipster&lt;/url&gt;
    &lt;defaultSchemaName&gt;&lt;/defaultSchemaName&gt;
    &lt;username&gt;catalogue&lt;/username&gt;
    &lt;password&gt;catalogue&lt;/password&gt;
    &lt;referenceUrl&gt;hibernate:spring:fr.tech.corree.domain?dialect=io.github.jhipster.domain.util.FixedPostgreSQL10Dialect
    &amp;amp;hibernate.physical_naming_strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    &amp;amp;hibernate.implicit_naming_strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl&lt;/referenceUrl&gt;
    &lt;!-- &lt;referenceUrl&gt;hibernate:spring:fr.tech.corree.domain?dialect=io.github.jhipster.domain.util.FixedPostgreSQL10Dialect
    &amp;amp;hibernate.physical_naming_strategy=fr.tech.corree.domain.naming.CataloguePhysicalNamingStrategyImpl
    &amp;amp;hibernate.implicit_naming_strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl&lt;/referenceUrl&gt; --&gt;
    &lt;verbose&gt;true&lt;/verbose&gt;
    &lt;logging&gt;debug&lt;/logging&gt;
    #*&lt;contexts&gt;test&lt;/contexts&gt; // ATTENTION JHIPSTER GENERE LE FICHIER AVEC &lt;contexts&gt;!test&lt;/contexts&gt;*#
&lt;/configuration&gt;
&lt;dependencies&gt;
// Dependencies
&lt;/dependencies&gt;
&lt;/plugin&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Puis en ligne de commande :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn liquibase:update</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
si la table est bloquée avec l&#8217;erreur mvn tourne en boucle en attendant la libération du verrou il faut, passer cette requête: UPDATE DATABASECHANGELOGLOCK SET LOCKED=false, LOCKGRANTED=null, LOCKEDBY=null where ID=1;
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La table est créée</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_flyway_optionnel">Installation Flyway (Optionnel)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il est possible de jouer les scripts avec Flyway au lieu de Liquibase.
Flyway gère la "convention over configuration, c&#8217;est-à-dire que une fois le plug-in installer il va scruter conventionnellement dans main/resources/db/migration et jouer les cripts qui s&#8217;y trouvent avec un ordre prédéfini par les noms de fichiers(voir plus bas)</p>
</div>
<div class="paragraph">
<p>Pour installer un plugin Flyway Maven, il faut ajouter la définition de plugin suivante dans le pom.xml :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;plugin&gt;
    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
    &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.0.3&lt;/version&gt;
&lt;/plugin&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Il faut vérifier la dernière version du plugin disponible sur Maven Central.
Ce plugin Maven peut être configuré de quatre manières différentes.
Consulter la documentation pour obtenir une liste de toutes les propriétés configurables.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration du plugin</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configurer le plugin directement via la balise &lt;configuration&gt; dans la définition du plugin de notre pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;plugin&gt;
    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
    &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;4.0.3&lt;/version&gt;
    &lt;configuration&gt;
        &lt;user&gt;databaseUser&lt;/user&gt;
        &lt;password&gt;databasePassword&lt;/password&gt;
        &lt;schemas&gt;
            &lt;schema&gt;schemaName&lt;/schema&gt;
        &lt;/schemas&gt;
        ...
    &lt;/configuration&gt;
&lt;/plugin&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Propriétés Maven</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configurer le plugin en spécifiant des propriétés configurables comme propriétés Maven dans notre pom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;project&gt;
    ...
    &lt;properties&gt;
        &lt;flyway.user&gt;databaseUser&lt;/flyway.user&gt;
        &lt;flyway.password&gt;databasePassword&lt;/flyway.password&gt;
        &lt;flyway.schemas&gt;schemaName&lt;/flyway.schemas&gt;
        ...
    &lt;/properties&gt;
    ...
&lt;/project&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fichier de configuration externe</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Configuration du plugin dans un fichier.properties séparé :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flyway.user=databaseUser
flyway.password=databasePassword
flyway.schemas=schemaName
...</pre>
</div>
</div>
<div class="paragraph">
<p>Le nom du fichier de configuration par défaut est flyway.properties et doit résider dans le même répertoire que le fichier pom.xml.
Le codage est spécifié par flyway.encoding (la valeur par défaut est UTF-8).</p>
</div>
<div class="paragraph">
<p>Pour utiliser un autre nom (par exemple customConfig.properties) comme fichier de configuration, il doit être spécifié explicitement lors de l’appel de la commande Maven :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn -Dflyway.configFile=customConfig.properties</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Propriétés du système</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Toutes les propriétés de configuration peuvent également être spécifiées en tant que propriétés systèmes lors de l’appel de Maven sur la ligne de commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn -Dflyway.user=databaseUser -Dflyway.password=databasePassword
  -Dflyway.schemas=schemaName</pre>
</div>
</div>
<div class="paragraph">
<p>Voici un ordre de priorité lorsqu’une configuration est spécifiée de plusieurs manières :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Propriétés du système
Fichier de configuration externe
Propriétés de Maven
Plugin configuration</pre>
</div>
</div>
<div class="sect2">
<h3 id="_première_migration">Première Migration</h3>
<div class="paragraph">
<p>Pour définir la première migration, Flyway adhère à la convention de dénomination suivante pour les scripts de migration :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Préfixe&gt;&lt;Version&gt; __ &lt;Description&gt;.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Où:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;Préfixe&gt; - Le préfixe par défaut est V , qui peut être configuré dans le fichier de configuration ci-dessus à l'aide de la propriété flyway.sqlMigrationPrefix .
&lt;Version&gt; - Numéro de version de la migration. Les versions majeures et mineures peuvent être séparées par un trait de soulignement . La version de migration doit toujours commencer par 1.
&lt;Description&gt; - Description textuelle de la migration. La description doit être séparée des numéros de version par un double trait de soulignement.</pre>
</div>
</div>
<div class="paragraph">
<p>Exemple :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>V1_1_0__ma_premiere_migration.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Ensuite appeler la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn clean flyway:migrate</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deuxième_migration">Deuxième Migration</h3>
<div class="paragraph">
<p>Une deuxième migration est faite en créant un deuxième fichier de migration avec le nom :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>V2_0_0_ma_deuxieme_migration.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Le 2 est une convention, en fait toute version supérieure à la première est considérée come une deuxième migration</p>
</div>
<div class="paragraph">
<p>Pour vérifier que les deux migrations ont bien réussi il faut appeler la commande Maven suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn flyway:info</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_désactivation_de_flyway_dans_spring_boot">Désactivation de Flyway dans Spring Boot</h3>
<div class="paragraph">
<p>Il faut définir la propriété spring.flyway.enabled dans le fichier application-{profile}}.properties :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.flyway.enabled=false</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_comment_fonctionne_flyway">Comment fonctionne Flyway</h3>
<div class="paragraph">
<p>Pour savoir quelles migrations ont déjà été appliquées, quand et par qui,
Flyway ajoute une table de comptabilité spéciale au schéma.</p>
</div>
<div class="paragraph">
<p>Cette table de métadonnées suit également les sommes de contrôle de migration et indique si les migrations ont réussi ou non.</p>
</div>
<div class="paragraph">
<p>Le framework effectue les étapes suivantes pour s&#8217;adapter aux schémas de base de données en évolution :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il vérifie un schéma de base de données pour localiser sa table de métadonnées (SCHEMA_VERSION par défaut).
Si la table de métadonnées n’existe pas, elle en créera une.</p>
</li>
<li>
<p>Il analyse un chemin de classe d&#8217;application pour les migrations disponibles</p>
</li>
<li>
<p>Il compare les migrations à la table de métadonnées.
Si un numéro de version est inférieur ou égal à une version marquée comme actuelle,
il est ignoré : par conséquent il ne faut pas modifier la numérotation des scripts après la première migration.</p>
</li>
<li>
<p>Il marque toutes les migrations restantes comme des migrations en attente.
Ceux-ci sont triés en fonction du numéro de version et sont exécutés dans l’ordre.</p>
</li>
<li>
<p>Au fur et à mesure que chaque migration est appliquée, la table de métadonnées est mise à jour en conséquence.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_commandes_mvn">Commandes mvn</h3>
<div class="paragraph">
<p>Flyway prend en charge les commandes de base suivantes pour gérer les migrations de bases de données.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Info : imprime l'état / la version actuelle d'un schéma de base de données. Il imprime quelles migrations sont en attente, quelles migrations ont été appliquées, quel est l'état des migrations appliquées et quand elles ont été appliquées.
Migrate : migre un schéma de base de données vers la version actuelle. Il analyse le chemin de classe pour les migrations disponibles et applique les migrations en attente.
Baseline : Baseline une base de données existante, à l'exclusion de toutes les migrations, y compris baselineVersion . Baseline aide à démarrer avec Flyway dans une base de données existante. Les migrations plus récentes peuvent alors être appliquées normalement.
Validate : valide le schéma de base de données actuel par rapport aux migrations disponibles.
Repair : réparations de la table de métadonnées.
Clean : supprime tous les objets dans un schéma configuré. Tous les objets de base de données sont supprimés. Bien sûr, vous ne devez jamais utiliser clean sur une base de données de production.</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-12-10 20:30:01 +0100
</div>
</div>
</body>
</html>